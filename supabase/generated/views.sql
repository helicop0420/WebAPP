           view           |                                                                                                                                query                                                                                                                                 
--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 inbox_page_view          |  SELECT user_profile.user_id,                                                                                                                                                                                                                                       +
                          |     ( SELECT json_agg(all_conversations.*) AS json_agg                                                                                                                                                                                                              +
                          |            FROM ( SELECT conv.id AS conversation_id,                                                                                                                                                                                                                +
                          |                     conv.is_marked_done,                                                                                                                                                                                                                            +
                          |                     conv.title,                                                                                                                                                                                                                                     +
                          |                     ( SELECT json_agg(chat_users.*) AS json_agg                                                                                                                                                                                                     +
                          |                            FROM ( SELECT other_user.user_id,                                                                                                                                                                                                        +
                          |                                     other_user.profile_pic_url,                                                                                                                                                                                                     +
                          |                                     other_user.handle,                                                                                                                                                                                                              +
                          |                                     org.name AS current_org_name,                                                                                                                                                                                                   +
                          |                                     other_user.current_org_position,                                                                                                                                                                                                +
                          |                                     other_user.first_name,                                                                                                                                                                                                          +
                          |                                     other_user.last_name                                                                                                                                                                                                            +
                          |                                    FROM conversation_to_user_associations ctua                                                                                                                                                                                      +
                          |                                      JOIN user_profiles other_user ON ctua.user_id = other_user.user_id                                                                                                                                                             +
                          |                                      LEFT JOIN organizations org ON other_user.current_org_id = org.id                                                                                                                                                              +
                          |                                   WHERE ctua.conversation_id = conv.id AND user_profile.user_id <> other_user.user_id) chat_users) AS users_in_conv,                                                                                                                +
                          |                     latest_message.user_id AS latest_message_user_id,                                                                                                                                                                                               +
                          |                     latest_message.content AS latest_message_content,                                                                                                                                                                                               +
                          |                     latest_message.created_at AS latest_message_sent_at,                                                                                                                                                                                            +
                          |                     ( SELECT count(*) AS count                                                                                                                                                                                                                      +
                          |                            FROM messages unread_message                                                                                                                                                                                                             +
                          |                           WHERE unread_message.conversation_id = conv.id AND NOT (unread_message.id IN ( SELECT read_message.id                                                                                                                                     +
                          |                                    FROM messages read_message                                                                                                                                                                                                       +
                          |                                      JOIN message_read_receipts ON message_read_receipts.message_id = read_message.id                                                                                                                                               +
                          |                                   WHERE message_read_receipts.user_id = user_profile.user_id))) AS number_of_unread_messages                                                                                                                                        +
                          |                    FROM conversations conv                                                                                                                                                                                                                          +
                          |                      JOIN conversation_to_user_associations conv_users ON conv_users.conversation_id = conv.id                                                                                                                                                      +
                          |                      LEFT JOIN ( SELECT message.id,                                                                                                                                                                                                                 +
                          |                             message.content,                                                                                                                                                                                                                        +
                          |                             message.conversation_id,                                                                                                                                                                                                                +
                          |                             message.created_at,                                                                                                                                                                                                                     +
                          |                             message.user_id,                                                                                                                                                                                                                        +
                          |                             latest_message_user.handle AS user_handle,                                                                                                                                                                                              +
                          |                             latest_message_user.profile_pic_url AS user_profile_pic_url,                                                                                                                                                                            +
                          |                             read_receipt.created_at AS read_at_time                                                                                                                                                                                                 +
                          |                            FROM ( SELECT DISTINCT ON (message_1.conversation_id) message_1.id,                                                                                                                                                                      +
                          |                                     message_1.created_at,                                                                                                                                                                                                           +
                          |                                     message_1.updated_at,                                                                                                                                                                                                           +
                          |                                     message_1.conversation_id,                                                                                                                                                                                                      +
                          |                                     message_1.content,                                                                                                                                                                                                              +
                          |                                     message_1.user_id,                                                                                                                                                                                                              +
                          |                                     message_1.on_deal_id,                                                                                                                                                                                                           +
                          |                                     message_1.nudged_time                                                                                                                                                                                                           +
                          |                                    FROM messages message_1                                                                                                                                                                                                          +
                          |                                   ORDER BY message_1.conversation_id, message_1.created_at DESC) message                                                                                                                                                            +
                          |                              JOIN user_profiles latest_message_user ON message.user_id = latest_message_user.user_id                                                                                                                                                +
                          |                              LEFT JOIN message_read_receipts read_receipt ON message.id = read_receipt.message_id AND read_receipt.user_id = user_profile.user_id) latest_message ON conv.id = latest_message.conversation_id                                       +
                          |                   WHERE conv_users.user_id = user_profile.user_id                                                                                                                                                                                                   +
                          |                   ORDER BY latest_message.created_at) all_conversations) AS all_conversations                                                                                                                                                                       +
                          |    FROM user_profiles user_profile;
 deal_interest_level_view |  SELECT deal_user_engagement.user_id,                                                                                                                                                                                                                               +
                          |     deal_user_engagement.deal_id,                                                                                                                                                                                                                                   +
                          |     deal_user_engagement.expressed_interest,                                                                                                                                                                                                                        +
                          |     deal_user_engagement.deal_view_count,                                                                                                                                                                                                                           +
                          |     deal_user_engagement.attachments_received,                                                                                                                                                                                                                      +
                          |         CASE                                                                                                                                                                                                                                                        +
                          |             WHEN deal_user_engagement.deal_view_count > 5 AND json_array_length(deal_user_engagement.attachments_received) > 0 THEN 'VeryInterested'::deal_interest_level                                                                                           +
                          |             WHEN deal_user_engagement.deal_view_count > 1 OR json_array_length(deal_user_engagement.attachments_received) > 0 THEN 'ModeratelyInterested'::deal_interest_level                                                                                      +
                          |             ELSE 'SlightlyInterested'::deal_interest_level                                                                                                                                                                                                          +
                          |         END AS interest_level                                                                                                                                                                                                                                       +
                          |    FROM ( SELECT user_profile.user_id,                                                                                                                                                                                                                              +
                          |             deal.id AS deal_id,                                                                                                                                                                                                                                     +
                          |             (EXISTS ( SELECT deal_interest.id                                                                                                                                                                                                                       +
                          |                    FROM deal_interest                                                                                                                                                                                                                               +
                          |                   WHERE deal_interest.deal_id = deal.id AND deal_interest.user_id = user_profile.user_id)) AS expressed_interest,                                                                                                                                   +
                          |             ( SELECT count(*) AS count                                                                                                                                                                                                                              +
                          |                    FROM deal_views                                                                                                                                                                                                                                  +
                          |                   WHERE deal_views.deal_id = deal.id AND deal_views.user_id = user_profile.user_id) AS deal_view_count,                                                                                                                                             +
                          |             ( SELECT json_agg(attachment_ids_in_convo.*) AS attachment_ids_in_convo                                                                                                                                                                                 +
                          |                    FROM ( SELECT deal_attachments.id,                                                                                                                                                                                                               +
                          |                             deal_filenames.filename                                                                                                                                                                                                                 +
                          |                            FROM deal_attachments                                                                                                                                                                                                                    +
                          |                              JOIN messages ON messages.deal_attachment_id = deal_attachments.id                                                                                                                                                                     +
                          |                              JOIN deal_filenames ON deal_filenames.id = deal_attachments.deal_filename_id                                                                                                                                                           +
                          |                              JOIN conversation_to_user_associations ON conversation_to_user_associations.conversation_id = messages.conversation_id                                                                                                                 +
                          |                           WHERE conversation_to_user_associations.user_id = user_profile.user_id AND deal_filenames.deal_id = deal.id) attachment_ids_in_convo) AS attachments_received                                                                             +
                          |            FROM user_profiles user_profile                                                                                                                                                                                                                          +
                          |              CROSS JOIN deals deal) deal_user_engagement;
 friends_list_view        |  SELECT person.from_user_id,                                                                                                                                                                                                                                        +
                          |     person.to_user_id,                                                                                                                                                                                                                                              +
                          |     friend.profile_pic_url,                                                                                                                                                                                                                                         +
                          |     friend.first_name,                                                                                                                                                                                                                                              +
                          |     friend.last_name,                                                                                                                                                                                                                                               +
                          |     friend.handle,                                                                                                                                                                                                                                                  +
                          |     friend.subtitle                                                                                                                                                                                                                                                 +
                          |    FROM ( SELECT connections.from_user_id,                                                                                                                                                                                                                          +
                          |             connections.to_user_id                                                                                                                                                                                                                                  +
                          |            FROM connections                                                                                                                                                                                                                                         +
                          |         UNION                                                                                                                                                                                                                                                       +
                          |          SELECT connections.to_user_id,                                                                                                                                                                                                                             +
                          |             connections.from_user_id                                                                                                                                                                                                                                +
                          |            FROM connections) person                                                                                                                                                                                                                                 +
                          |      JOIN user_profiles friend ON person.to_user_id = friend.user_id;
 autocomplete_users_view  |  SELECT friends_list_view.from_user_id,                                                                                                                                                                                                                             +
                          |     friends_list_view.to_user_id,                                                                                                                                                                                                                                   +
                          |     friends_list_view.profile_pic_url,                                                                                                                                                                                                                              +
                          |     friends_list_view.first_name,                                                                                                                                                                                                                                   +
                          |     friends_list_view.last_name,                                                                                                                                                                                                                                    +
                          |     friends_list_view.handle,                                                                                                                                                                                                                                       +
                          |     friends_list_view.subtitle                                                                                                                                                                                                                                      +
                          |    FROM friends_list_view                                                                                                                                                                                                                                           +
                          | UNION                                                                                                                                                                                                                                                               +
                          |  SELECT user_profiles.user_id AS from_user_id,                                                                                                                                                                                                                      +
                          |     user_profiles.user_id AS to_user_id,                                                                                                                                                                                                                            +
                          |     user_profiles.profile_pic_url,                                                                                                                                                                                                                                  +
                          |     user_profiles.first_name,                                                                                                                                                                                                                                       +
                          |     user_profiles.last_name,                                                                                                                                                                                                                                        +
                          |     user_profiles.handle,                                                                                                                                                                                                                                           +
                          |     user_profiles.subtitle                                                                                                                                                                                                                                          +
                          |    FROM user_profiles;
 mutual_connections_view  |  SELECT user_profile.user_id,                                                                                                                                                                                                                                       +
                          |     ( SELECT json_agg(mutual_connections.*) AS json_agg                                                                                                                                                                                                             +
                          |            FROM ( SELECT your_friend.to_user_id AS user_id,                                                                                                                                                                                                         +
                          |                     your_friend.handle,                                                                                                                                                                                                                             +
                          |                     your_friend.profile_pic_url,                                                                                                                                                                                                                    +
                          |                     your_friend.first_name,                                                                                                                                                                                                                         +
                          |                     your_friend.last_name                                                                                                                                                                                                                           +
                          |                    FROM friends_list_view their_friend                                                                                                                                                                                                              +
                          |                      JOIN friends_list_view your_friend ON their_friend.to_user_id = your_friend.to_user_id                                                                                                                                                         +
                          |                   WHERE their_friend.from_user_id = user_profile.user_id AND your_friend.from_user_id = auth.uid()) mutual_connections) AS mutual_connections                                                                                                       +
                          |    FROM user_profiles user_profile;
 inbox_conversation_view  |  SELECT conversation_to_user_associations.user_id AS for_user_id,                                                                                                                                                                                                   +
                          |     conv.id AS conversation_id,                                                                                                                                                                                                                                     +
                          |     conv.is_marked_done,                                                                                                                                                                                                                                            +
                          |     conv.title,                                                                                                                                                                                                                                                     +
                          |     ( SELECT json_agg(chat_users.*) AS json_agg                                                                                                                                                                                                                     +
                          |            FROM ( SELECT other_user.user_id,                                                                                                                                                                                                                        +
                          |                     other_user.profile_pic_url,                                                                                                                                                                                                                     +
                          |                     other_user.handle,                                                                                                                                                                                                                              +
                          |                     org.name AS current_org_name,                                                                                                                                                                                                                   +
                          |                     other_user.current_org_position,                                                                                                                                                                                                                +
                          |                     other_user.first_name,                                                                                                                                                                                                                          +
                          |                     other_user.last_name                                                                                                                                                                                                                            +
                          |                    FROM conversation_to_user_associations ctua                                                                                                                                                                                                      +
                          |                      JOIN user_profiles other_user ON ctua.user_id = other_user.user_id                                                                                                                                                                             +
                          |                      LEFT JOIN organizations org ON other_user.current_org_id = org.id                                                                                                                                                                              +
                          |                   WHERE ctua.conversation_id = conv.id AND conversation_to_user_associations.user_id <> other_user.user_id) chat_users) AS users_in_conv,                                                                                                           +
                          |     ( SELECT json_agg(all_messages.*) AS all_messages                                                                                                                                                                                                               +
                          |            FROM ( SELECT message.id,                                                                                                                                                                                                                                +
                          |                     message.user_id,                                                                                                                                                                                                                                +
                          |                     sender_user.first_name AS sender_user_first_name,                                                                                                                                                                                               +
                          |                     sender_user.last_name AS sender_user_last_name,                                                                                                                                                                                                 +
                          |                     sender_user.handle AS sender_user_handle,                                                                                                                                                                                                       +
                          |                     sender_user.profile_pic_url AS sender_user_profile_pic_url,                                                                                                                                                                                     +
                          |                     message.content,                                                                                                                                                                                                                                +
                          |                     message.created_at,                                                                                                                                                                                                                             +
                          |                     message.nudged_time,                                                                                                                                                                                                                            +
                          |                     message.on_deal_id,                                                                                                                                                                                                                             +
                          |                     deal_attachments.storage_url AS attachment_url,                                                                                                                                                                                                 +
                          |                     deal_attachments.attachment_type,                                                                                                                                                                                                               +
                          |                     deal_attachments.size_in_bytes AS attachment_size_in_bytes,                                                                                                                                                                                     +
                          |                     deal_attachments.total_num_pages AS attachment_total_num_pages,                                                                                                                                                                                 +
                          |                     deal_filenames.filename AS attachment_filename,                                                                                                                                                                                                 +
                          |                     ( SELECT json_agg(attachment_stats.*) AS attachment_stats                                                                                                                                                                                       +
                          |                            FROM ( SELECT deal_attachment_stats.user_id,                                                                                                                                                                                             +
                          |                                     stats_for_user.first_name,                                                                                                                                                                                                      +
                          |                                     stats_for_user.last_name,                                                                                                                                                                                                       +
                          |                                     stats_for_user.handle,                                                                                                                                                                                                          +
                          |                                     stats_for_user.profile_pic_url,                                                                                                                                                                                                 +
                          |                                     deal_attachment_stats.updated_at AS last_seen_at,                                                                                                                                                                               +
                          |                                     deal_attachment_stats.progress,                                                                                                                                                                                                 +
                          |                                     deal_attachment_stats.view_count                                                                                                                                                                                                +
                          |                                    FROM deal_attachment_stats                                                                                                                                                                                                       +
                          |                                      JOIN user_profiles stats_for_user ON deal_attachment_stats.user_id = stats_for_user.user_id                                                                                                                                    +
                          |                                   WHERE deal_attachment_stats.deal_attachment_id = deal_attachments.id AND deal_attachment_stats.user_id <> conversation_to_user_associations.user_id) attachment_stats) AS attachment_stats,                                       +
                          |                     deal.title AS deal_title,                                                                                                                                                                                                                       +
                          |                     deal.handle AS deal_handle,                                                                                                                                                                                                                     +
                          |                     deal.about AS deal_about,                                                                                                                                                                                                                       +
                          |                     ( SELECT deal_image.image_url                                                                                                                                                                                                                   +
                          |                            FROM deal_images deal_image                                                                                                                                                                                                              +
                          |                           WHERE deal_image.deal_id = message.on_deal_id                                                                                                                                                                                             +
                          |                           ORDER BY deal_image.order_index                                                                                                                                                                                                           +
                          |                          LIMIT 1) AS deal_image,                                                                                                                                                                                                                    +
                          |                     ( SELECT json_agg(all_read_receipts.*) AS json_agg                                                                                                                                                                                              +
                          |                            FROM ( SELECT mrr.created_at AS read_at,                                                                                                                                                                                                 +
                          |                                     mrr.user_id AS read_by_user_id                                                                                                                                                                                                  +
                          |                                    FROM message_read_receipts mrr                                                                                                                                                                                                   +
                          |                                   WHERE mrr.message_id = message.id) all_read_receipts) AS all_read_receipts                                                                                                                                                        +
                          |                    FROM messages message                                                                                                                                                                                                                            +
                          |                      JOIN user_profiles sender_user ON sender_user.user_id = message.user_id                                                                                                                                                                        +
                          |                      LEFT JOIN deals deal ON deal.id = message.on_deal_id                                                                                                                                                                                           +
                          |                      LEFT JOIN deal_attachments ON message.deal_attachment_id = deal_attachments.id                                                                                                                                                                 +
                          |                      LEFT JOIN deal_filenames ON deal_filenames.id = deal_attachments.deal_filename_id                                                                                                                                                              +
                          |                   WHERE message.conversation_id = conv.id) all_messages) AS all_messages,                                                                                                                                                                           +
                          |     ( SELECT json_agg(all_conversation_changes.*) AS all_conversation_changes                                                                                                                                                                                       +
                          |            FROM ( SELECT conversation_changes.id,                                                                                                                                                                                                                   +
                          |                     conversation_changes.created_at,                                                                                                                                                                                                                +
                          |                     conversation_changes.updated_at,                                                                                                                                                                                                                +
                          |                     conversation_changes.conversation_id,                                                                                                                                                                                                           +
                          |                     conversation_changes.renamed_to,                                                                                                                                                                                                                +
                          |                     conversation_changes.added_user_id,                                                                                                                                                                                                             +
                          |                     conversation_changes.removed_user_id,                                                                                                                                                                                                           +
                          |                     removed_user.first_name AS removed_user_first_name,                                                                                                                                                                                             +
                          |                     removed_user.last_name AS removed_user_last_name,                                                                                                                                                                                               +
                          |                     removed_user.handle AS removed_user_handle                                                                                                                                                                                                      +
                          |                    FROM conversation_changes                                                                                                                                                                                                                        +
                          |                      LEFT JOIN user_profiles removed_user ON conversation_changes.removed_user_id = removed_user.user_id                                                                                                                                            +
                          |                   WHERE conversation_changes.conversation_id = conv.id) all_conversation_changes) AS all_conversation_changes,                                                                                                                                      +
                          |     ( SELECT json_agg(all_deal_interest_levels.*) AS all_deal_interest_levels                                                                                                                                                                                       +
                          |            FROM ( SELECT deal_interest_level_view.user_id,                                                                                                                                                                                                          +
                          |                     deal_interest_level_view.deal_id,                                                                                                                                                                                                               +
                          |                     deal_interest_level_view.expressed_interest,                                                                                                                                                                                                    +
                          |                     deal_interest_level_view.deal_view_count,                                                                                                                                                                                                       +
                          |                     deal_interest_level_view.attachments_received,                                                                                                                                                                                                  +
                          |                     deal_interest_level_view.interest_level                                                                                                                                                                                                         +
                          |                    FROM deal_interest_level_view                                                                                                                                                                                                                    +
                          |                   WHERE deal_interest_level_view.user_id = conversation_to_user_associations.user_id) all_deal_interest_levels) AS all_deal_interest_levels,                                                                                                        +
                          |     ( SELECT json_agg(all_attachments_in_convo.*) AS all_attachments_in_convo                                                                                                                                                                                       +
                          |            FROM ( SELECT msg.id AS message_id,                                                                                                                                                                                                                      +
                          |                     df.filename,                                                                                                                                                                                                                                    +
                          |                     df.deal_id                                                                                                                                                                                                                                      +
                          |                    FROM messages msg                                                                                                                                                                                                                                +
                          |                      JOIN deal_attachments da ON msg.deal_attachment_id = da.id                                                                                                                                                                                     +
                          |                      JOIN deal_filenames df ON da.deal_filename_id = df.id                                                                                                                                                                                          +
                          |                   WHERE msg.conversation_id = conv.id) all_attachments_in_convo) AS all_attachments_in_convo                                                                                                                                                        +
                          |    FROM conversations conv                                                                                                                                                                                                                                          +
                          |      JOIN conversation_to_user_associations ON conversation_to_user_associations.conversation_id = conv.id                                                                                                                                                          +
                          |   ORDER BY conv.id;
 search_users_view        |  SELECT user_profiles.user_id,                                                                                                                                                                                                                                      +
                          |     user_profiles.first_name,                                                                                                                                                                                                                                       +
                          |     user_profiles.last_name,                                                                                                                                                                                                                                        +
                          |     user_profiles.handle,                                                                                                                                                                                                                                           +
                          |     user_profiles.profile_pic_url,                                                                                                                                                                                                                                  +
                          |     user_profiles.subtitle,                                                                                                                                                                                                                                         +
                          |     (EXISTS ( SELECT connections.id,                                                                                                                                                                                                                                +
                          |             connections.created_at,                                                                                                                                                                                                                                 +
                          |             connections.updated_at,                                                                                                                                                                                                                                 +
                          |             connections.from_user_id,                                                                                                                                                                                                                               +
                          |             connections.to_user_id                                                                                                                                                                                                                                  +
                          |            FROM connections                                                                                                                                                                                                                                         +
                          |           WHERE connections.from_user_id = auth.uid() AND connections.to_user_id = user_profiles.user_id OR connections.from_user_id = user_profiles.user_id AND connections.to_user_id = auth.uid())) AS is_connected,                                             +
                          |     json_array_length(mutual_connections_view.mutual_connections) AS num_mutuals,                                                                                                                                                                                   +
                          |     mutual_connections_view.mutual_connections                                                                                                                                                                                                                      +
                          |    FROM user_profiles                                                                                                                                                                                                                                               +
                          |      JOIN mutual_connections_view ON mutual_connections_view.user_id = user_profiles.user_id;
 inbox_page_view_v2       |  SELECT user_profile.user_id,                                                                                                                                                                                                                                       +
                          |     conv.id AS conversation_id,                                                                                                                                                                                                                                     +
                          |     deal.id AS deal_id,                                                                                                                                                                                                                                             +
                          |     conv.is_marked_done,                                                                                                                                                                                                                                            +
                          |     deal_interest_level_view.interest_level,                                                                                                                                                                                                                        +
                          |     row_to_json(deal_interest_level_view.*) AS deal_interest_level_breakdown,                                                                                                                                                                                       +
                          |     (EXISTS ( SELECT deal_interest.id                                                                                                                                                                                                                               +
                          |            FROM deal_interest                                                                                                                                                                                                                                       +
                          |           WHERE deal_interest.deal_id = deal.id AND deal_interest.user_id = user_profile.user_id)) AS expressed_interest,                                                                                                                                           +
                          |     ( SELECT array_agg(deal_attachments.id) AS array_agg                                                                                                                                                                                                            +
                          |            FROM messages message                                                                                                                                                                                                                                    +
                          |              JOIN deal_attachments ON deal_attachments.id = message.deal_attachment_id                                                                                                                                                                              +
                          |           WHERE message.conversation_id = conv.id) AS attachment_ids_in_convo,                                                                                                                                                                                      +
                          |     conv.title,                                                                                                                                                                                                                                                     +
                          |     ( SELECT json_agg(chat_users.*) AS json_agg                                                                                                                                                                                                                     +
                          |            FROM ( SELECT other_user.user_id,                                                                                                                                                                                                                        +
                          |                     other_user.profile_pic_url,                                                                                                                                                                                                                     +
                          |                     other_user.handle,                                                                                                                                                                                                                              +
                          |                     org.name AS current_org_name,                                                                                                                                                                                                                   +
                          |                     other_user.current_org_position,                                                                                                                                                                                                                +
                          |                     other_user.first_name,                                                                                                                                                                                                                          +
                          |                     other_user.last_name                                                                                                                                                                                                                            +
                          |                    FROM conversation_to_user_associations ctua                                                                                                                                                                                                      +
                          |                      JOIN user_profiles other_user ON ctua.user_id = other_user.user_id                                                                                                                                                                             +
                          |                      LEFT JOIN organizations org ON other_user.current_org_id = org.id                                                                                                                                                                              +
                          |                   WHERE ctua.conversation_id = conv.id AND user_profile.user_id <> other_user.user_id) chat_users) AS users_in_conv,                                                                                                                                +
                          |     latest_message.user_id AS latest_message_user_id,                                                                                                                                                                                                               +
                          |     latest_message.content AS latest_message_content,                                                                                                                                                                                                               +
                          |     latest_message.created_at AS latest_message_sent_at,                                                                                                                                                                                                            +
                          |     latest_message_read_receipt.created_at AS read_at_time,                                                                                                                                                                                                         +
                          |     ( SELECT count(*) AS count                                                                                                                                                                                                                                      +
                          |            FROM messages unread_message                                                                                                                                                                                                                             +
                          |           WHERE unread_message.conversation_id = conv.id AND NOT (unread_message.id IN ( SELECT read_message.id                                                                                                                                                     +
                          |                    FROM messages read_message                                                                                                                                                                                                                       +
                          |                      JOIN message_read_receipts ON message_read_receipts.message_id = read_message.id                                                                                                                                                               +
                          |                   WHERE message_read_receipts.user_id = user_profile.user_id))) AS number_of_unread_messages                                                                                                                                                        +
                          |    FROM conversations conv                                                                                                                                                                                                                                          +
                          |      JOIN conversation_to_user_associations conv_users ON conv_users.conversation_id = conv.id                                                                                                                                                                      +
                          |      JOIN user_profiles user_profile ON conv_users.user_id = user_profile.user_id                                                                                                                                                                                   +
                          |      LEFT JOIN ( SELECT DISTINCT ON (latest_message_1.conversation_id) latest_message_1.id,                                                                                                                                                                         +
                          |             latest_message_1.created_at,                                                                                                                                                                                                                            +
                          |             latest_message_1.updated_at,                                                                                                                                                                                                                            +
                          |             latest_message_1.conversation_id,                                                                                                                                                                                                                       +
                          |             latest_message_1.content,                                                                                                                                                                                                                               +
                          |             latest_message_1.user_id,                                                                                                                                                                                                                               +
                          |             latest_message_1.on_deal_id,                                                                                                                                                                                                                            +
                          |             latest_message_1.nudged_time                                                                                                                                                                                                                            +
                          |            FROM messages latest_message_1                                                                                                                                                                                                                           +
                          |           ORDER BY latest_message_1.conversation_id, latest_message_1.created_at DESC) latest_message ON conv.id = latest_message.conversation_id                                                                                                                   +
                          |      LEFT JOIN message_read_receipts latest_message_read_receipt ON latest_message.id = latest_message_read_receipt.message_id                                                                                                                                      +
                          |      LEFT JOIN deal_accesses deal_access ON deal_access.user_id = user_profile.user_id                                                                                                                                                                              +
                          |      LEFT JOIN deals deal ON deal_access.deal_id = deal.id                                                                                                                                                                                                          +
                          |      LEFT JOIN deal_interest_level_view ON deal.id = deal_interest_level_view.deal_id AND user_profile.user_id = deal_interest_level_view.user_id                                                                                                                   +
                          |   WHERE conv_users.user_id = user_profile.user_id                                                                                                                                                                                                                   +
                          |   ORDER BY user_profile.user_id, latest_message.created_at DESC;
 sponsor_deals_view       |  SELECT user_profile.user_id,                                                                                                                                                                                                                                       +
                          |     ( SELECT json_agg(deals.*) AS json_agg                                                                                                                                                                                                                          +
                          |            FROM ( SELECT deal.id,                                                                                                                                                                                                                                   +
                          |                     deal.title,                                                                                                                                                                                                                                     +
                          |                     deal.about,                                                                                                                                                                                                                                     +
                          |                     deal.is_active,                                                                                                                                                                                                                                 +
                          |                     deal.handle,                                                                                                                                                                                                                                    +
                          |                     ( SELECT deal_image.image_url                                                                                                                                                                                                                   +
                          |                            FROM deal_images deal_image                                                                                                                                                                                                              +
                          |                           WHERE deal.id = deal_image.deal_id                                                                                                                                                                                                        +
                          |                           ORDER BY deal_image.order_index, deal_image.created_at                                                                                                                                                                                    +
                          |                          LIMIT 1) AS deal_image,                                                                                                                                                                                                                    +
                          |                     deal.interest_count,                                                                                                                                                                                                                            +
                          |                     ( SELECT dtsa.sponsor_id                                                                                                                                                                                                                        +
                          |                            FROM deal_to_sponsor_associations dtsa                                                                                                                                                                                                   +
                          |                           WHERE dtsa.deal_id = deal.id                                                                                                                                                                                                              +
                          |                           ORDER BY dtsa.order_index                                                                                                                                                                                                                 +
                          |                          LIMIT 1) AS leader_user_id,                                                                                                                                                                                                                +
                          |                     deal.created_at,                                                                                                                                                                                                                                +
                          |                     deal_access.unique_share_link                                                                                                                                                                                                                   +
                          |                    FROM deals deal                                                                                                                                                                                                                                  +
                          |                      JOIN deal_to_sponsor_associations ON deal_to_sponsor_associations.deal_id = deal.id                                                                                                                                                            +
                          |                      LEFT JOIN deal_accesses deal_access ON deal_access.deal_id = deal.id AND deal_access.user_id = user_profile.user_id                                                                                                                            +
                          |                      JOIN user_profiles sponsor_user_profile ON sponsor_user_profile.user_id = deal_to_sponsor_associations.sponsor_id                                                                                                                              +
                          |                   WHERE deal_to_sponsor_associations.sponsor_id = user_profile.user_id OR sponsor_user_profile.current_org_id IS NOT NULL AND sponsor_user_profile.current_org_id = user_profile.current_org_id) deals) AS deals                                    +
                          |    FROM user_profiles user_profile;
 user_invite_limit_view   |  SELECT user_profile.user_id,                                                                                                                                                                                                                                       +
                          |     5 AS invite_limit                                                                                                                                                                                                                                               +
                          |    FROM user_profiles user_profile;
 deal_dashboard_view      |  SELECT user_profiles.user_id,                                                                                                                                                                                                                                      +
                          |     ( SELECT json_agg(deals.*) AS json_agg                                                                                                                                                                                                                          +
                          |            FROM ( SELECT deal.id,                                                                                                                                                                                                                                   +
                          |                     deal.handle,                                                                                                                                                                                                                                    +
                          |                     deal.launch_date,                                                                                                                                                                                                                               +
                          |                     deal.title,                                                                                                                                                                                                                                     +
                          |                     deal.is_active,                                                                                                                                                                                                                                 +
                          |                     ( SELECT json_agg(sponsors.*) AS sponsors                                                                                                                                                                                                       +
                          |                            FROM ( SELECT sponsor.user_id,                                                                                                                                                                                                           +
                          |                                     sponsor.handle,                                                                                                                                                                                                                 +
                          |                                     sponsor.profile_pic_url,                                                                                                                                                                                                        +
                          |                                     sponsor.subtitle,                                                                                                                                                                                                               +
                          |                                     sponsor.first_name,                                                                                                                                                                                                             +
                          |                                     sponsor.last_name                                                                                                                                                                                                               +
                          |                                    FROM deal_to_sponsor_associations dtsa                                                                                                                                                                                           +
                          |                                      JOIN user_profiles sponsor ON dtsa.sponsor_id = sponsor.user_id                                                                                                                                                                +
                          |                                   WHERE dtsa.deal_id = deal.id) sponsors) AS sponsors,                                                                                                                                                                              +
                          |                     deal_to_sponsor_associations.* IS NOT NULL AS is_sponsor,                                                                                                                                                                                       +
                          |                     deal_accesses.unique_share_link AS deal_unique_share_link                                                                                                                                                                                       +
                          |                    FROM deals deal                                                                                                                                                                                                                                  +
                          |                      LEFT JOIN deal_to_sponsor_associations ON deal_to_sponsor_associations.deal_id = deal.id AND deal_to_sponsor_associations.sponsor_id = user_profiles.user_id                                                                                   +
                          |                      JOIN deal_accesses ON deal.id = deal_accesses.deal_id AND deal_accesses.user_id = user_profiles.user_id) deals) AS deals                                                                                                                       +
                          |    FROM user_profiles;
 deal_share_view          |  SELECT user_profile.user_id,                                                                                                                                                                                                                                       +
                          |     deal.title AS deal_title,                                                                                                                                                                                                                                       +
                          |     deal.id AS deal_id,                                                                                                                                                                                                                                             +
                          |     deal.handle AS deal_handle,                                                                                                                                                                                                                                     +
                          |     deal_access.unique_share_link,                                                                                                                                                                                                                                  +
                          |     ( SELECT json_agg(suggested_share_users.*) AS suggested_share_users                                                                                                                                                                                             +
                          |            FROM ( SELECT friends_list_view.to_user_id,                                                                                                                                                                                                              +
                          |                     friends_list_view.handle,                                                                                                                                                                                                                       +
                          |                     friends_list_view.first_name,                                                                                                                                                                                                                   +
                          |                     friends_list_view.last_name,                                                                                                                                                                                                                    +
                          |                     friends_list_view.profile_pic_url,                                                                                                                                                                                                              +
                          |                     friends_list_view.subtitle                                                                                                                                                                                                                      +
                          |                    FROM friends_list_view                                                                                                                                                                                                                           +
                          |                      LEFT JOIN deal_shares deal_share ON deal_share.deal_id = deal.id AND deal_share.from_user_id = user_profile.user_id AND deal_share.to_user_id = friends_list_view.to_user_id                                                                   +
                          |                      LEFT JOIN deal_to_sponsor_associations dtsa ON dtsa.deal_id = deal.id AND dtsa.sponsor_id = friends_list_view.to_user_id                                                                                                                       +
                          |                   WHERE friends_list_view.from_user_id = user_profile.user_id AND deal_share.id IS NULL AND dtsa.id IS NULL                                                                                                                                         +
                          |                  LIMIT 20) suggested_share_users) AS suggested_share_users,                                                                                                                                                                                         +
                          |     ( SELECT json_agg(shared_with.*) AS shared_with                                                                                                                                                                                                                 +
                          |            FROM ( SELECT deal_share.created_at AS shared_at,                                                                                                                                                                                                        +
                          |                     shared_user.user_id,                                                                                                                                                                                                                            +
                          |                     shared_user.handle,                                                                                                                                                                                                                             +
                          |                     shared_user.first_name,                                                                                                                                                                                                                         +
                          |                     shared_user.last_name,                                                                                                                                                                                                                          +
                          |                     shared_user.profile_pic_url,                                                                                                                                                                                                                    +
                          |                     shared_user.subtitle,                                                                                                                                                                                                                           +
                          |                     deal_view.created_at AS deal_viewed_at,                                                                                                                                                                                                         +
                          |                     di.created_at AS expressed_interest_at                                                                                                                                                                                                          +
                          |                    FROM deal_shares deal_share                                                                                                                                                                                                                      +
                          |                      JOIN user_profiles shared_user ON shared_user.user_id = deal_share.to_user_id                                                                                                                                                                  +
                          |                      LEFT JOIN deal_views deal_view ON deal_view.deal_id = deal.id AND deal_view.user_id = shared_user.user_id                                                                                                                                      +
                          |                      LEFT JOIN deal_interest di ON di.deal_id = deal.id AND di.user_id = shared_user.user_id                                                                                                                                                        +
                          |                   WHERE deal_share.deal_id = deal.id AND deal_share.from_user_id = user_profile.user_id) shared_with) AS shared_with,                                                                                                                               +
                          |     ( SELECT json_agg(invites_outstanding.*) AS invites_outstanding                                                                                                                                                                                                 +
                          |            FROM ( SELECT invite.to_email                                                                                                                                                                                                                            +
                          |                    FROM invites invite                                                                                                                                                                                                                              +
                          |                   WHERE invite.on_deal_id = deal.id AND invite.from_user_id = user_profile.user_id AND invite.is_accepted = false) invites_outstanding) AS invites_outstanding,                                                                                     +
                          |     user_invite_limit_view.invite_limit - (( SELECT count(*) AS count                                                                                                                                                                                               +
                          |            FROM invites invite                                                                                                                                                                                                                                      +
                          |           WHERE invite.from_user_id = user_profile.user_id AND invite.is_accepted = true)) AS invites_left                                                                                                                                                          +
                          |    FROM user_profiles user_profile                                                                                                                                                                                                                                  +
                          |      JOIN deal_accesses deal_access ON deal_access.user_id = user_profile.user_id                                                                                                                                                                                   +
                          |      LEFT JOIN deals deal ON deal.id = deal_access.deal_id                                                                                                                                                                                                          +
                          |      JOIN user_invite_limit_view ON user_invite_limit_view.user_id = user_profile.user_id;
 deal_analytics_view      |  SELECT deal.id,                                                                                                                                                                                                                                                    +
                          |     ( SELECT json_agg(data.*) AS data                                                                                                                                                                                                                               +
                          |            FROM ( SELECT user_profile.user_id,                                                                                                                                                                                                                      +
                          |                     user_profile.first_name,                                                                                                                                                                                                                        +
                          |                     user_profile.last_name,                                                                                                                                                                                                                         +
                          |                     user_profile.profile_pic_url,                                                                                                                                                                                                                   +
                          |                     user_profile.handle,                                                                                                                                                                                                                            +
                          |                     deal_interest_level_view.interest_level,                                                                                                                                                                                                        +
                          |                     row_to_json(deal_interest_level_view.*) AS deal_interest_level_breakdown,                                                                                                                                                                       +
                          |                     (EXISTS ( SELECT deal_interest.id                                                                                                                                                                                                               +
                          |                            FROM deal_interest                                                                                                                                                                                                                       +
                          |                           WHERE deal_interest.user_id = user_profile.user_id AND deal_interest.deal_id = deal.id)) AS expressed_interest,                                                                                                                           +
                          |                     ( SELECT count(*) AS count                                                                                                                                                                                                                      +
                          |                            FROM deal_views                                                                                                                                                                                                                          +
                          |                           WHERE deal_views.deal_id = deal.id AND deal_views.user_id = user_profile.user_id) AS view_count,                                                                                                                                          +
                          |                     ( SELECT json_agg(all_attachment_stats.*) AS all_attachment_stats                                                                                                                                                                               +
                          |                            FROM ( SELECT deal_filename.filename,                                                                                                                                                                                                    +
                          |                                     (EXISTS ( SELECT 1                                                                                                                                                                                                              +
                          |    FROM messages message_w_attachment                                                                                                                                                                                                                               +
                          |      JOIN deal_attachments ON message_w_attachment.deal_attachment_id = deal_attachments.id                                                                                                                                                                         +
                          |      JOIN conversation_to_user_associations ctua ON ctua.conversation_id = message_w_attachment.conversation_id                                                                                                                                                     +
                          |   WHERE ctua.user_id = user_profile.user_id AND deal_attachments.deal_filename_id = deal_filename.id)) AS has_received,                                                                                                                                             +
                          |                                     ( SELECT sum(das.view_count) AS sum                                                                                                                                                                                             +
                          |    FROM deal_attachment_stats das                                                                                                                                                                                                                                   +
                          |      JOIN deal_attachments ON deal_attachments.id = das.deal_attachment_id                                                                                                                                                                                          +
                          |   WHERE deal_attachments.deal_filename_id = deal_filename.id AND das.user_id = user_profile.user_id) AS view_count                                                                                                                                                  +
                          |                                    FROM deal_filenames deal_filename                                                                                                                                                                                                +
                          |                                   WHERE deal_filename.deal_id = deal.id) all_attachment_stats) AS all_attachment_stats,                                                                                                                                             +
                          |                     ( SELECT json_agg(referred_users.*) AS referred_users                                                                                                                                                                                           +
                          |                            FROM ( SELECT referred_user.user_id,                                                                                                                                                                                                     +
                          |                                     referred_user.first_name,                                                                                                                                                                                                       +
                          |                                     referred_user.last_name,                                                                                                                                                                                                        +
                          |                                     referred_user.profile_pic_url,                                                                                                                                                                                                  +
                          |                                     referred_user.subtitle,                                                                                                                                                                                                         +
                          |                                     referred_user.handle                                                                                                                                                                                                            +
                          |                                    FROM deal_shares deal_share                                                                                                                                                                                                      +
                          |                                      JOIN user_profiles referred_user ON referred_user.user_id = deal_share.to_user_id                                                                                                                                              +
                          |                                   WHERE deal_share.deal_id = deal.id AND deal_share.from_user_id = user_profile.user_id) referred_users) AS referred_users,                                                                                                         +
                          |                     ( SELECT json_agg(referred_by_users.*) AS referred_by_users                                                                                                                                                                                     +
                          |                            FROM ( SELECT referred_by_user.user_id,                                                                                                                                                                                                  +
                          |                                     referred_by_user.first_name,                                                                                                                                                                                                    +
                          |                                     referred_by_user.last_name,                                                                                                                                                                                                     +
                          |                                     referred_by_user.profile_pic_url,                                                                                                                                                                                               +
                          |                                     referred_by_user.handle,                                                                                                                                                                                                        +
                          |                                     referred_by_user.subtitle,                                                                                                                                                                                                      +
                          |                                     deal_share.created_at AS referred_at                                                                                                                                                                                            +
                          |                                    FROM deal_shares deal_share                                                                                                                                                                                                      +
                          |                                      JOIN user_profiles referred_by_user ON referred_by_user.user_id = deal_share.from_user_id                                                                                                                                      +
                          |                                   WHERE deal_share.deal_id = deal.id AND deal_share.to_user_id = user_profile.user_id) referred_by_users) AS referred_by_users,                                                                                                     +
                          |                     private_note.note AS team_notes,                                                                                                                                                                                                                +
                          |                     private_note.id AS private_note_id,                                                                                                                                                                                                             +
                          |                     private_note.updated_at AS private_note_last_edited_at,                                                                                                                                                                                         +
                          |                     private_note_last_edited_user.user_id AS private_note_last_edited_user_id,                                                                                                                                                                      +
                          |                     private_note_last_edited_user.first_name AS private_note_last_edited_user_first_name,                                                                                                                                                           +
                          |                     private_note_last_edited_user.last_name AS private_note_last_edited_user_last_name,                                                                                                                                                             +
                          |                     private_note_last_edited_user.profile_pic_url AS private_note_last_edited_user_profile_pic_url,                                                                                                                                                 +
                          |                     private_note_last_edited_user.handle AS private_note_last_edited_user_handle                                                                                                                                                                    +
                          |                    FROM user_profiles user_profile                                                                                                                                                                                                                  +
                          |                      LEFT JOIN private_notes private_note ON private_note.deal_id = deal.id AND private_note.user_id = user_profile.user_id                                                                                                                         +
                          |                      LEFT JOIN user_profiles private_note_last_edited_user ON private_note.last_edit_by_user_id = private_note_last_edited_user.user_id                                                                                                             +
                          |                      LEFT JOIN deal_interest_level_view ON deal.id = deal_interest_level_view.deal_id AND user_profile.user_id = deal_interest_level_view.user_id                                                                                                   +
                          |                      JOIN deal_accesses ON deal_accesses.user_id = user_profile.user_id                                                                                                                                                                             +
                          |                      LEFT JOIN deal_to_sponsor_associations ON deal_to_sponsor_associations.deal_id = deal.id AND deal_to_sponsor_associations.sponsor_id = user_profile.user_id                                                                                    +
                          |                   WHERE deal_accesses.deal_id = deal.id AND deal_to_sponsor_associations.id IS NULL) data) AS data                                                                                                                                                  +
                          |    FROM deals deal;
 profile_page_view        |  SELECT user_profile.user_id,                                                                                                                                                                                                                                       +
                          |     user_profile.handle,                                                                                                                                                                                                                                            +
                          |     user_profile.profile_pic_url,                                                                                                                                                                                                                                   +
                          |     user_profile.cover_photo_url,                                                                                                                                                                                                                                   +
                          |     user_profile.first_name,                                                                                                                                                                                                                                        +
                          |     user_profile.last_name,                                                                                                                                                                                                                                         +
                          |     user_profile.is_verified,                                                                                                                                                                                                                                       +
                          |     user_profile.subtitle,                                                                                                                                                                                                                                          +
                          |     user_profile.is_sponsor,                                                                                                                                                                                                                                        +
                          |     user_profile.is_investor,                                                                                                                                                                                                                                       +
                          |     user_profile.current_org_id,                                                                                                                                                                                                                                    +
                          |     user_profile.current_org_position,                                                                                                                                                                                                                              +
                          |     org.profile_pic_url AS current_org_profile_pic_url,                                                                                                                                                                                                             +
                          |     org.name AS current_org_name,                                                                                                                                                                                                                                   +
                          |     user_profile.created_at,                                                                                                                                                                                                                                        +
                          |     user_profile.nominated_by_user_id,                                                                                                                                                                                                                              +
                          |     nominated_by_user_profile.profile_pic_url AS nominated_by_user_profile_pic_url,                                                                                                                                                                                 +
                          |     nominated_by_user_profile.first_name AS nominated_by_user_first_name,                                                                                                                                                                                           +
                          |     nominated_by_user_profile.last_name AS nominated_by_user_last_name,                                                                                                                                                                                             +
                          |     nominated_by_user_profile.handle AS nominated_by_user_handle,                                                                                                                                                                                                   +
                          |     user_profile.about,                                                                                                                                                                                                                                             +
                          |     user_profile.connections_count,                                                                                                                                                                                                                                 +
                          |     mutual_connections_view.mutual_connections,                                                                                                                                                                                                                     +
                          |     user_profile.linkedin_url,                                                                                                                                                                                                                                      +
                          |     user_profile.facebook_url,                                                                                                                                                                                                                                      +
                          |     user_profile.instagram_url,                                                                                                                                                                                                                                     +
                          |     user_profile.twitter_url,                                                                                                                                                                                                                                       +
                          |     sponsor_deals_view.deals,                                                                                                                                                                                                                                       +
                          |     ( SELECT json_agg(endorsements.*) AS json_agg                                                                                                                                                                                                                   +
                          |            FROM ( SELECT endorsing_user.handle AS endorsing_user_handle,                                                                                                                                                                                            +
                          |                     endorsing_user.user_id AS endorsing_user_user_id,                                                                                                                                                                                               +
                          |                     endorsing_user.profile_pic_url AS endorsing_user_profile_pic_url,                                                                                                                                                                               +
                          |                     endorsing_user.first_name AS endorsing_user_first_name,                                                                                                                                                                                         +
                          |                     endorsing_user.last_name AS endorsing_user_last_name,                                                                                                                                                                                           +
                          |                     endorsement.created_at,                                                                                                                                                                                                                         +
                          |                     endorsement.relationship,                                                                                                                                                                                                                       +
                          |                     endorsement.text,                                                                                                                                                                                                                               +
                          |                     endorsement.on_deal                                                                                                                                                                                                                             +
                          |                    FROM endorsements endorsement                                                                                                                                                                                                                    +
                          |                      JOIN user_profiles endorsing_user ON endorsement.author_user_id = endorsing_user.user_id                                                                                                                                                       +
                          |                   WHERE endorsement.to_user_id = user_profile.user_id) endorsements) AS endorsements,                                                                                                                                                               +
                          |     ( SELECT json_agg(people_you_may_know.*) AS people_you_may_know                                                                                                                                                                                                 +
                          |            FROM ( SELECT people_you_may_know_1.user_id,                                                                                                                                                                                                             +
                          |                     people_you_may_know_1.first_name,                                                                                                                                                                                                               +
                          |                     people_you_may_know_1.last_name,                                                                                                                                                                                                                +
                          |                     people_you_may_know_1.handle,                                                                                                                                                                                                                   +
                          |                     people_you_may_know_1.profile_pic_url,                                                                                                                                                                                                          +
                          |                     people_you_may_know_1.subtitle,                                                                                                                                                                                                                 +
                          |                     people_you_may_know_1.is_connected,                                                                                                                                                                                                             +
                          |                     people_you_may_know_1.num_mutuals,                                                                                                                                                                                                              +
                          |                     people_you_may_know_1.mutual_connections                                                                                                                                                                                                        +
                          |                    FROM search_users_view people_you_may_know_1                                                                                                                                                                                                     +
                          |                   WHERE people_you_may_know_1.is_connected = false AND people_you_may_know_1.user_id <> auth.uid()                                                                                                                                                  +
                          |                   ORDER BY people_you_may_know_1.num_mutuals DESC) people_you_may_know) AS people_you_may_know                                                                                                                                                      +
                          |    FROM user_profiles user_profile                                                                                                                                                                                                                                  +
                          |      LEFT JOIN organizations org ON user_profile.current_org_id = org.id                                                                                                                                                                                            +
                          |      LEFT JOIN user_profiles nominated_by_user_profile ON user_profile.nominated_by_user_id = nominated_by_user_profile.user_id                                                                                                                                     +
                          |      LEFT JOIN sponsor_deals_view ON sponsor_deals_view.user_id = user_profile.user_id                                                                                                                                                                              +
                          |      LEFT JOIN mutual_connections_view ON mutual_connections_view.user_id = user_profile.user_id;
 notifications_view       |  SELECT user_profile.user_id,                                                                                                                                                                                                                                       +
                          |     ( SELECT json_agg(all_notifs.*) AS all_notifs                                                                                                                                                                                                                   +
                          |            FROM ( SELECT notification.id,                                                                                                                                                                                                                           +
                          |                     notification.created_at,                                                                                                                                                                                                                        +
                          |                     notification.updated_at,                                                                                                                                                                                                                        +
                          |                     notification.receiving_user_id,                                                                                                                                                                                                                 +
                          |                     notification.from_user_id,                                                                                                                                                                                                                      +
                          |                     notification.is_seen,                                                                                                                                                                                                                           +
                          |                     notification.debug_info,                                                                                                                                                                                                                        +
                          |                     notification.attached_deal_id,                                                                                                                                                                                                                  +
                          |                     notification.attached_org_id,                                                                                                                                                                                                                   +
                          |                     notification.notification_type,                                                                                                                                                                                                                 +
                          |                     from_user.first_name,                                                                                                                                                                                                                           +
                          |                     from_user.last_name,                                                                                                                                                                                                                            +
                          |                     from_user.handle,                                                                                                                                                                                                                               +
                          |                     from_user.profile_pic_url,                                                                                                                                                                                                                      +
                          |                     org.name AS attached_org_name,                                                                                                                                                                                                                  +
                          |                     org.profile_pic_url AS attached_org_profile_pic_url,                                                                                                                                                                                            +
                          |                     deal.handle AS attached_deal_handle,                                                                                                                                                                                                            +
                          |                     deal.title AS attached_deal_title,                                                                                                                                                                                                              +
                          |                     deal_access.unique_share_link                                                                                                                                                                                                                   +
                          |                    FROM notifications notification                                                                                                                                                                                                                  +
                          |                      JOIN user_profiles from_user ON notification.from_user_id = from_user.user_id                                                                                                                                                                  +
                          |                      LEFT JOIN organizations org ON org.id = notification.attached_org_id                                                                                                                                                                           +
                          |                      LEFT JOIN deals deal ON deal.id = notification.attached_deal_id                                                                                                                                                                                +
                          |                      LEFT JOIN deal_accesses deal_access ON deal_access.deal_id = deal.id AND deal_access.user_id = user_profile.user_id                                                                                                                            +
                          |                   WHERE notification.receiving_user_id = user_profile.user_id) all_notifs) AS notifications,                                                                                                                                                        +
                          |     ( SELECT json_agg(all_connection_reqs.*) AS all_connection_reqs                                                                                                                                                                                                 +
                          |            FROM ( SELECT connection_request.id,                                                                                                                                                                                                                     +
                          |                     connection_request.is_seen,                                                                                                                                                                                                                     +
                          |                     connection_request.from_user_id,                                                                                                                                                                                                                +
                          |                     connection_request.created_at,                                                                                                                                                                                                                  +
                          |                     requester.first_name,                                                                                                                                                                                                                           +
                          |                     requester.last_name,                                                                                                                                                                                                                            +
                          |                     requester.handle,                                                                                                                                                                                                                               +
                          |                     requester.profile_pic_url,                                                                                                                                                                                                                      +
                          |                     (EXISTS ( SELECT 1                                                                                                                                                                                                                              +
                          |                            FROM connections conn                                                                                                                                                                                                                    +
                          |                           WHERE conn.from_user_id = connection_request.from_user_id AND conn.to_user_id = connection_request.to_user_id OR conn.from_user_id = connection_request.to_user_id AND conn.to_user_id = connection_request.from_user_id)) AS is_connected+
                          |                    FROM connection_requests connection_request                                                                                                                                                                                                      +
                          |                      LEFT JOIN user_profiles requester ON connection_request.from_user_id = requester.user_id                                                                                                                                                       +
                          |                   WHERE connection_request.to_user_id = user_profile.user_id) all_connection_reqs) AS connection_requests                                                                                                                                           +
                          |    FROM user_profiles user_profile;
 organization_page_view   |  SELECT org.id,                                                                                                                                                                                                                                                     +
                          |     org.handle,                                                                                                                                                                                                                                                     +
                          |     org.cover_photo_url,                                                                                                                                                                                                                                            +
                          |     org.profile_pic_url,                                                                                                                                                                                                                                            +
                          |     org.name,                                                                                                                                                                                                                                                       +
                          |     org.headline,                                                                                                                                                                                                                                                   +
                          |     org.headquarters,                                                                                                                                                                                                                                               +
                          |     org.email,                                                                                                                                                                                                                                                      +
                          |     org.about,                                                                                                                                                                                                                                                      +
                          |     org.website_url,                                                                                                                                                                                                                                                +
                          |     org.linkedin_url,                                                                                                                                                                                                                                               +
                          |     org.instagram_url,                                                                                                                                                                                                                                              +
                          |     org.twitter_url,                                                                                                                                                                                                                                                +
                          |     org.leadership_bio,                                                                                                                                                                                                                                             +
                          |     ( SELECT json_agg(team_members.*) AS team_members                                                                                                                                                                                                               +
                          |            FROM ( SELECT otua.is_current,                                                                                                                                                                                                                           +
                          |                     otua.is_leadership,                                                                                                                                                                                                                             +
                          |                     otua.job_title,                                                                                                                                                                                                                                 +
                          |                     otua.order_index,                                                                                                                                                                                                                               +
                          |                     team_member.user_id AS team_member_user_id,                                                                                                                                                                                                     +
                          |                     team_member.handle AS team_member_handle,                                                                                                                                                                                                       +
                          |                     team_member.profile_pic_url AS team_member_profile_pic_url,                                                                                                                                                                                     +
                          |                     team_member.first_name AS team_member_first_name,                                                                                                                                                                                               +
                          |                     team_member.last_name AS team_member_last_name,                                                                                                                                                                                                 +
                          |                     team_member.subtitle AS team_member_subtitle,                                                                                                                                                                                                   +
                          |                     team_member.twitter_url AS team_member_twitter_url,                                                                                                                                                                                             +
                          |                     team_member.linkedin_url AS team_member_linkedin_url,                                                                                                                                                                                           +
                          |                     team_member.connections_count AS team_member_connections_count,                                                                                                                                                                                 +
                          |                     mutual_connections_view.mutual_connections AS team_member_mutual_connections,                                                                                                                                                                   +
                          |                     (EXISTS ( SELECT connections.id,                                                                                                                                                                                                                +
                          |                             connections.created_at,                                                                                                                                                                                                                 +
                          |                             connections.updated_at,                                                                                                                                                                                                                 +
                          |                             connections.from_user_id,                                                                                                                                                                                                               +
                          |                             connections.to_user_id                                                                                                                                                                                                                  +
                          |                            FROM connections                                                                                                                                                                                                                         +
                          |                           WHERE connections.from_user_id = auth.uid() AND connections.to_user_id = team_member.user_id OR connections.from_user_id = team_member.user_id AND connections.to_user_id = auth.uid())) AS team_member_is_connected                      +
                          |                    FROM organization_to_user_associations otua                                                                                                                                                                                                      +
                          |                      JOIN user_profiles team_member ON team_member.user_id = otua.user_id                                                                                                                                                                           +
                          |                      JOIN mutual_connections_view ON mutual_connections_view.user_id = team_member.user_id                                                                                                                                                          +
                          |                   WHERE otua.org_id = org.id) team_members) AS team_members,                                                                                                                                                                                        +
                          |     ( SELECT json_agg(deals.*) AS json_agg                                                                                                                                                                                                                          +
                          |            FROM ( SELECT deal.id,                                                                                                                                                                                                                                   +
                          |                     deal.title,                                                                                                                                                                                                                                     +
                          |                     deal.about,                                                                                                                                                                                                                                     +
                          |                     deal.is_active,                                                                                                                                                                                                                                 +
                          |                     deal.handle,                                                                                                                                                                                                                                    +
                          |                     ( SELECT deal_image.image_url                                                                                                                                                                                                                   +
                          |                            FROM deal_images deal_image                                                                                                                                                                                                              +
                          |                           WHERE deal.id = deal_image.deal_id                                                                                                                                                                                                        +
                          |                           ORDER BY deal_image.order_index, deal_image.created_at                                                                                                                                                                                    +
                          |                          LIMIT 1) AS deal_image,                                                                                                                                                                                                                    +
                          |                     deal.interest_count,                                                                                                                                                                                                                            +
                          |                     ( SELECT dtsa.sponsor_id                                                                                                                                                                                                                        +
                          |                            FROM deal_to_sponsor_associations dtsa                                                                                                                                                                                                   +
                          |                           WHERE dtsa.deal_id = deal.id                                                                                                                                                                                                              +
                          |                           ORDER BY dtsa.order_index                                                                                                                                                                                                                 +
                          |                          LIMIT 1) AS leader_user_id,                                                                                                                                                                                                                +
                          |                     deal.created_at,                                                                                                                                                                                                                                +
                          |                     deal_access.unique_share_link                                                                                                                                                                                                                   +
                          |                    FROM deals deal                                                                                                                                                                                                                                  +
                          |                      JOIN deal_to_sponsor_associations ON deal_to_sponsor_associations.deal_id = deal.id                                                                                                                                                            +
                          |                      LEFT JOIN deal_accesses deal_access ON deal_access.deal_id = deal.id AND deal_access.user_id = deal_to_sponsor_associations.sponsor_id                                                                                                         +
                          |                      JOIN organization_to_user_associations ON organization_to_user_associations.user_id = deal_to_sponsor_associations.sponsor_id                                                                                                                  +
                          |                   WHERE organization_to_user_associations.org_id = org.id) deals) AS deals,                                                                                                                                                                         +
                          |     ( SELECT json_agg(team_members_you_may_know.*) AS team_members_you_may_know                                                                                                                                                                                     +
                          |            FROM ( SELECT team_member_you_may_know.user_id,                                                                                                                                                                                                          +
                          |                     team_member_you_may_know.first_name,                                                                                                                                                                                                            +
                          |                     team_member_you_may_know.last_name,                                                                                                                                                                                                             +
                          |                     team_member_you_may_know.handle,                                                                                                                                                                                                                +
                          |                     team_member_you_may_know.profile_pic_url,                                                                                                                                                                                                       +
                          |                     team_member_you_may_know.subtitle,                                                                                                                                                                                                              +
                          |                     team_member_you_may_know.is_connected,                                                                                                                                                                                                          +
                          |                     team_member_you_may_know.num_mutuals,                                                                                                                                                                                                           +
                          |                     team_member_you_may_know.mutual_connections                                                                                                                                                                                                     +
                          |                    FROM search_users_view team_member_you_may_know                                                                                                                                                                                                  +
                          |                      JOIN organization_to_user_associations ON organization_to_user_associations.user_id = team_member_you_may_know.user_id                                                                                                                         +
                          |                   WHERE organization_to_user_associations.org_id = org.id AND team_member_you_may_know.is_connected = false AND team_member_you_may_know.user_id <> auth.uid()                                                                                      +
                          |                   ORDER BY team_member_you_may_know.num_mutuals DESC) team_members_you_may_know) AS team_members_you_may_know                                                                                                                                       +
                          |    FROM organizations org;
 deal_page_view           |  SELECT deal.id,                                                                                                                                                                                                                                                    +
                          |     deal.title,                                                                                                                                                                                                                                                     +
                          |     deal.highlight_1_name,                                                                                                                                                                                                                                          +
                          |     deal.highlight_1_value,                                                                                                                                                                                                                                         +
                          |     deal.highlight_2_name,                                                                                                                                                                                                                                          +
                          |     deal.highlight_2_value,                                                                                                                                                                                                                                         +
                          |     deal.highlight_term,                                                                                                                                                                                                                                            +
                          |     deal.highlight_term_value,                                                                                                                                                                                                                                      +
                          |     deal.highlight_equity_raise,                                                                                                                                                                                                                                    +
                          |     deal.highlight_equity_raise_value,                                                                                                                                                                                                                              +
                          |     deal.handle,                                                                                                                                                                                                                                                    +
                          |     deal.about,                                                                                                                                                                                                                                                     +
                          |     deal.is_active,                                                                                                                                                                                                                                                 +
                          |     deal.launch_date,                                                                                                                                                                                                                                               +
                          |     deal.webinar_url,                                                                                                                                                                                                                                               +
                          |     deal.calendly_url,                                                                                                                                                                                                                                              +
                          |     ( SELECT json_agg(cur_deal_images.*) AS json_agg                                                                                                                                                                                                                +
                          |            FROM ( SELECT deal_image.id,                                                                                                                                                                                                                             +
                          |                     deal_image.created_at,                                                                                                                                                                                                                          +
                          |                     deal_image.updated_at,                                                                                                                                                                                                                          +
                          |                     deal_image.deal_id,                                                                                                                                                                                                                             +
                          |                     deal_image.image_url,                                                                                                                                                                                                                           +
                          |                     deal_image.order_index                                                                                                                                                                                                                          +
                          |                    FROM deal_images deal_image                                                                                                                                                                                                                      +
                          |                   WHERE deal_image.deal_id = deal.id) cur_deal_images) AS deal_images,                                                                                                                                                                              +
                          |     ( SELECT count(*) AS count                                                                                                                                                                                                                                      +
                          |            FROM deal_views                                                                                                                                                                                                                                          +
                          |           WHERE deal_views.deal_id = deal.id) AS deal_views,                                                                                                                                                                                                        +
                          |     deal.interest_count,                                                                                                                                                                                                                                            +
                          |     ( SELECT json_agg(cur_deal_interests.*) AS json_agg                                                                                                                                                                                                             +
                          |            FROM ( SELECT interested_user.user_id,                                                                                                                                                                                                                   +
                          |                     interested_user.first_name,                                                                                                                                                                                                                     +
                          |                     interested_user.last_name,                                                                                                                                                                                                                      +
                          |                     interested_user.profile_pic_url,                                                                                                                                                                                                                +
                          |                     interested_user.handle,                                                                                                                                                                                                                         +
                          |                     interested_user.subtitle                                                                                                                                                                                                                        +
                          |                    FROM deal_interest                                                                                                                                                                                                                               +
                          |                      JOIN user_profiles interested_user ON interested_user.user_id = deal_interest.user_id                                                                                                                                                          +
                          |                   WHERE deal_interest.deal_id = deal.id) cur_deal_interests) AS connections_deal_interest,                                                                                                                                                          +
                          |     ( SELECT json_agg(all_comments.*) AS json_agg                                                                                                                                                                                                                   +
                          |            FROM ( SELECT comment.id,                                                                                                                                                                                                                                +
                          |                     comment.created_at,                                                                                                                                                                                                                             +
                          |                     comment.updated_at,                                                                                                                                                                                                                             +
                          |                     comment.user_id,                                                                                                                                                                                                                                +
                          |                     commenting_user.handle,                                                                                                                                                                                                                         +
                          |                     commenting_user.first_name,                                                                                                                                                                                                                     +
                          |                     commenting_user.last_name,                                                                                                                                                                                                                      +
                          |                     commenting_user.profile_pic_url,                                                                                                                                                                                                                +
                          |                     comment.comment,                                                                                                                                                                                                                                +
                          |                     comment.replying_to_comment_id,                                                                                                                                                                                                                 +
                          |                     comment.type,                                                                                                                                                                                                                                   +
                          |                     comment.likes_count,                                                                                                                                                                                                                            +
                          |                     comment.is_private,                                                                                                                                                                                                                             +
                          |                     ( SELECT json_agg(comment_likes.*) AS json_agg                                                                                                                                                                                                  +
                          |                            FROM ( SELECT comment_like.user_id,                                                                                                                                                                                                      +
                          |                                     liking_user.first_name,                                                                                                                                                                                                         +
                          |                                     liking_user.last_name,                                                                                                                                                                                                          +
                          |                                     liking_user.profile_pic_url,                                                                                                                                                                                                    +
                          |                                     liking_user.handle,                                                                                                                                                                                                             +
                          |                                     liking_user.subtitle                                                                                                                                                                                                            +
                          |                                    FROM deal_comment_likes comment_like                                                                                                                                                                                             +
                          |                                      JOIN user_profiles liking_user ON comment_like.user_id = liking_user.user_id                                                                                                                                                   +
                          |                                   WHERE comment_like.deal_comment_id = comment.id) comment_likes) AS likes                                                                                                                                                          +
                          |                    FROM deal_comments comment                                                                                                                                                                                                                       +
                          |                      JOIN user_profiles commenting_user ON commenting_user.user_id = comment.user_id                                                                                                                                                                +
                          |                   WHERE comment.deal_id = deal.id) all_comments) AS deal_comments,                                                                                                                                                                                  +
                          |     ( SELECT json_agg(deal_faqs.*) AS deal_faqs                                                                                                                                                                                                                     +
                          |            FROM ( SELECT faq.id,                                                                                                                                                                                                                                    +
                          |                     faq.created_at,                                                                                                                                                                                                                                 +
                          |                     faq.updated_at,                                                                                                                                                                                                                                 +
                          |                     faq.question,                                                                                                                                                                                                                                   +
                          |                     faq.answer                                                                                                                                                                                                                                      +
                          |                    FROM deal_faqs faq                                                                                                                                                                                                                               +
                          |                   WHERE faq.deal_id = deal.id) deal_faqs) AS deal_faqs,                                                                                                                                                                                             +
                          |     ( SELECT json_agg(sponsors.*) AS json_agg                                                                                                                                                                                                                       +
                          |            FROM ( SELECT sponsor.user_id,                                                                                                                                                                                                                           +
                          |                     sponsor.first_name,                                                                                                                                                                                                                             +
                          |                     sponsor.last_name,                                                                                                                                                                                                                              +
                          |                     sponsor.handle,                                                                                                                                                                                                                                 +
                          |                     sponsor.subtitle,                                                                                                                                                                                                                               +
                          |                     sponsor.profile_pic_url,                                                                                                                                                                                                                        +
                          |                     sponsor.current_org_position,                                                                                                                                                                                                                   +
                          |                     sponsor_org.name AS current_org_name,                                                                                                                                                                                                           +
                          |                     sponsor_deals_view.deals,                                                                                                                                                                                                                       +
                          |                     mutual_connections_view.mutual_connections,                                                                                                                                                                                                     +
                          |                     deal_to_sponsor_associations.order_index,                                                                                                                                                                                                       +
                          |                     deal_to_sponsor_associations.id AS deal_to_sponsor_association_id,                                                                                                                                                                              +
                          |                     ( SELECT json_agg(org_members.*) AS org_members                                                                                                                                                                                                 +
                          |                            FROM ( SELECT org_member.user_id,                                                                                                                                                                                                        +
                          |                                     org_member.first_name,                                                                                                                                                                                                          +
                          |                                     org_member.last_name,                                                                                                                                                                                                           +
                          |                                     org_member.profile_pic_url,                                                                                                                                                                                                     +
                          |                                     org_member.handle,                                                                                                                                                                                                              +
                          |                                     org_member.current_org_position                                                                                                                                                                                                 +
                          |                                    FROM user_profiles org_member                                                                                                                                                                                                    +
                          |                                   WHERE org_member.current_org_id = sponsor.current_org_id AND org_member.user_id <> sponsor.user_id) org_members) AS org_members                                                                                                   +
                          |                    FROM deal_to_sponsor_associations                                                                                                                                                                                                                +
                          |                      JOIN sponsor_deals_view ON sponsor_deals_view.user_id = deal_to_sponsor_associations.sponsor_id                                                                                                                                                +
                          |                      JOIN mutual_connections_view ON mutual_connections_view.user_id = deal_to_sponsor_associations.sponsor_id                                                                                                                                      +
                          |                      JOIN user_profiles sponsor ON deal_to_sponsor_associations.sponsor_id = sponsor.user_id                                                                                                                                                        +
                          |                      LEFT JOIN organizations sponsor_org ON sponsor_org.id = sponsor.current_org_id                                                                                                                                                                 +
                          |                   WHERE deal_to_sponsor_associations.deal_id = deal.id                                                                                                                                                                                              +
                          |                   ORDER BY deal_to_sponsor_associations.order_index) sponsors) AS deal_sponsors,                                                                                                                                                                    +
                          |     ( SELECT json_agg(referrer.*) AS referrer                                                                                                                                                                                                                       +
                          |            FROM ( SELECT referrer_1.user_id,                                                                                                                                                                                                                        +
                          |                     referrer_1.first_name,                                                                                                                                                                                                                          +
                          |                     referrer_1.last_name,                                                                                                                                                                                                                           +
                          |                     referrer_1.profile_pic_url,                                                                                                                                                                                                                     +
                          |                     referrer_1.handle                                                                                                                                                                                                                               +
                          |                    FROM user_profiles referrer_1                                                                                                                                                                                                                    +
                          |                      JOIN deal_shares deal_share ON deal_share.to_user_id = auth.uid() AND deal_share.deal_id = deal.id AND deal_share.from_user_id = referrer_1.user_id                                                                                            +
                          |                   ORDER BY deal_share.created_at                                                                                                                                                                                                                    +
                          |                  LIMIT 1) referrer) AS referrer,                                                                                                                                                                                                                    +
                          |     user_invite_limit_view.invite_limit - (( SELECT count(*) AS count                                                                                                                                                                                               +
                          |            FROM invites invite                                                                                                                                                                                                                                      +
                          |           WHERE invite.from_user_id = auth.uid() AND invite.is_accepted = true)) AS invites_left                                                                                                                                                                    +
                          |    FROM deals deal                                                                                                                                                                                                                                                  +
                          |      LEFT JOIN user_invite_limit_view ON user_invite_limit_view.user_id = auth.uid();
(17 rows)

